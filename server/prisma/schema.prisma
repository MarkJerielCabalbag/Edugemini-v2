// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id          Int       @id     @default(autoincrement())
  username    String    
  email       String
  password    String?

  listOfCreatedClassroom Classroom[]
  student                Student?
}

model Student {
  relatedToUser       User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId              Int         @id    @unique
  lastname            String
  firstname           String
  middlename          String
  sex                 String            
  status              ClassroomStatus   @default(PENDING)

  relatedtoClassroom  Classroom?        @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  roomId              Int?
}

model Classroom {
  id                Int         @id      @default(autoincrement())
  classname         String
  section           String
  subject           String
  room              String
  classcode         String?
  status            ClassroomStatus       @default(PENDING)
  relatedToUser     User                  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId            Int

  listOfAnnouncements Announcement[]
  listOfActivity      Activity[]
  listOfStudents      Student[]
}

model Activity {
  id                  Int         @id      @default(autoincrement())
  title               String
  date                String
  time                String
  instruction         String?

  criteria            Files[]

  relatedToClassroom  Classroom           @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  roomId              Int
}


model Announcement {
  id                  Int         @id      @default(autoincrement())
  title               String
  description         String?
  relatedToClassroom  Classroom            @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  roomId              Int
  listOfFiles         Files[]
}

enum ClassroomStatus {
  PENDING
  DECLINED
  APPROVED
}

model Files {
  id                    Int           @id         @default(autoincrement())
  filename              String        
  mimetype              String
  fileSize              Int
  folderPath            String?
  filePath              String?

  relatedToActivity     Activity?                   @relation(fields: [activityId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  activityId            Int?

  relatedToAnnouncement Announcement?               @relation(fields: [announceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  announceId            Int?
}